// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  CONSUMER
  PARTNER
  ADMIN
}

enum PricingTier {
  Standard
  Premium
  Elite
}

enum InquiryStatus {
  PENDING
  RESPONDED
  CLOSED
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  role      UserRole @default(CONSUMER)
  name      String?
  firstName String?
  lastName  String?
  avatarUrl String?
  location  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  ownedCompany    Company?
  savedListings   SavedListing[]
  sentInquiries   Inquiry[] @relation("ConsumerInquiries")

  @@index([email])
  @@index([role])
}

model Company {
  id              String      @id @default(cuid())
  name            String
  description    String      @db.Text
  shortDescription String
  logoUrl        String?
  bannerUrl      String?
  isVerified     Boolean     @default(false)
  rating         Float       @default(0) @db.DoublePrecision
  reviewCount    Int         @default(0)
  category       String
  location       String
  tags           String[]    @default([])
  pricingTier    PricingTier @default(Standard)
  contactEmail   String
  website        String?
  ownerId        String      @unique
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  // Relations
  owner         User         @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  services      Service[]
  portfolio     PortfolioItem[]
  testimonials Testimonial[]
  savedBy       SavedListing[]
  inquiries     Inquiry[]    @relation("CompanyInquiries")
  subscriptions Subscription[]
  analytics     Analytics[]

  @@index([category])
  @@index([location])
  @@index([isVerified])
  @@index([pricingTier])
}

model Service {
  id          String   @id @default(cuid())
  companyId   String
  title       String
  description String   @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

model PortfolioItem {
  id        String   @id @default(cuid())
  companyId String
  title     String
  imageUrl  String
  category  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

model Testimonial {
  id        String   @id @default(cuid())
  companyId String
  author    String
  role      String
  company   String
  content   String   @db.Text
  rating    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  companyRelation Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

model SavedListing {
  id        String   @id @default(cuid())
  consumerId String
  companyId  String
  createdAt  DateTime @default(now())

  consumer User    @relation(fields: [consumerId], references: [id], onDelete: Cascade)
  company  Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([consumerId, companyId])
  @@index([consumerId])
  @@index([companyId])
}

model Inquiry {
  id        String        @id @default(cuid())
  consumerId String
  companyId  String
  message   String        @db.Text
  status    InquiryStatus @default(PENDING)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  consumer User    @relation("ConsumerInquiries", fields: [consumerId], references: [id], onDelete: Cascade)
  company  Company @relation("CompanyInquiries", fields: [companyId], references: [id], onDelete: Cascade)

  @@index([consumerId])
  @@index([companyId])
  @@index([status])
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
}

model Location {
  id        String   @id @default(cuid())
  name      String   @unique
  slug      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
}

model Subscription {
  id        String      @id @default(cuid())
  companyId String
  tier      PricingTier
  status    String      @default("active")
  startDate DateTime
  endDate   DateTime?
  createdAt DateTime    @default(now())
  updatedAt DateTime   @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([status])
}

model Analytics {
  id        String   @id @default(cuid())
  companyId String
  eventType String
  metadata  Json?
  createdAt DateTime @default(now())

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([eventType])
  @@index([createdAt])
}
